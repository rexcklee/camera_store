<div class="flex justify-between items-start">
    <div class="flex flex-col justify-center items-center basis-5/12">
        <h1 class="mb-2">Checkout Items</h1>
        <% @total_cents = 0 %>
        <% cart.each do |product| %>
        <div class='border-2 border-white w-full m-auto mb-5 p-4 rounded-md flex justify-center items-center'>
            <div class='basis-5/12'>
                <% if product.image.present? %>
                    <p><%= image_tag(product.image, style: 'height:150px', class:'m-auto') %></p>
                <% end %>
            </div>
            <div class='basis-7/12 text-center'>
                <h3><span class="text-red-400"><%= product.brand.name %> - <%= link_to product.name, product %></span></h3>
                <p>Unit price: <span class="text-red-400"><%= number_to_currency (product.price_cents/100.0) %></span></p>
                <% if item = session[:cart].find{ |cart_product| cart_product['id']== product.id}%>
                    <p>Quantity: <span class="text-red-400"><%= item['qty'] %></span></p>
                <% end %>
                <% @subtotal_cents = product.price_cents*item['qty'].to_i %>
                <% @total_cents += @subtotal_cents%>
                <p>Sub-total: <span class="text-red-400"><%= number_to_currency (@subtotal_cents/100.0) %></span></p>
            </div>
        </div>
        <%end%>
    </div>

    <div class="flex flex-col justify-center items-center basis-6/12">
        <h1 class="mb-2">Payment information</h1>
        <div class="border-2 border-white w-full m-auto mb-5 p-4 rounded-md flex flex-col items-start">
            
            <% if shipping_address = session[:address] %>
                <p>Address: <span class="text-red-400"><%= shipping_address %></span></p>
            <% end %>
            <% if province = session[:province] %>
                <p>Province: <span class="text-red-400"><%= province["name"] %></span></p>
            <% end %>
            <% if @gst !=0 %>
                <p>GST: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0*@gst) %></span></p>
            <% end %>
            <% if @pst !=0 %>
                <p>PST: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0*@pst) %></span></p>
            <% end %>
            <% if @hst !=0 %>
                <p>HST: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0*@hst) %></span></p>
            <% end %>
            <p>Item(s) Sub-total: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0) %></span></p>
            <p>Estimated Tax: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0*(@gst+@pst+@hst)) %></span></p>
            <% @total_tax_rate = (@gst+@pst+@hst) %>
            <p>Order Total: <span class="text-red-400"><%= number_to_currency (@total_cents/100.0*(1+@gst+@pst+@hst)) %></span></p>
        </div>
        <div>
            <% if !current_customer.present? || !current_customer.province.present? %>
                <div>
                    <%= form_with(url: cart_shipping_address_path, method: :get, local: true) do |form| %>
                    <%= hidden_field_tag(:total_cents, @total_cents)%>
                    <div class="flex justify-center items-center mb-2 w-full">
                        <div class="text-black basis-3/7">
                            <%= text_field_tag(:address, nil, class: "input", placeholder: 'Shipping Address') %>
                        </div>
                        <div class="text-black basis-3/7">
                            <%= form.select :province, options_for_select(Province.all.map {|province| [province.name, province.id]}) %>
                        </div>
                        <div class="border border-gray-200 ml-1 bg-green-700 rounded-md p-2 basis-1/7">
                            <%= submit_tag("Update", class: "button is-primary") %>
                        </div>
                    </div>
                    <% end %>
                </div>
            <% end %>
            <% if province = session[:province] %>
            <div class="w-full text-center">
                <%= form_with(url: cart_order_path, method: :get, local: true) do |form| %>
                <%= hidden_field_tag(:total_cents, @total_cents)%>
                <%= hidden_field_tag(:total_tax_rate, @total_tax_rate)%>
                    <div class="hover:text-white border border-gray-200 bg-yellow-400 text-black rounded-md p-2">
                        <%= submit_tag("Confirm Order", class: "button is-primary") %>
                    </div>
                <% end %>
            </div>
            <% end %>
        </div>
    </div>
</div>
